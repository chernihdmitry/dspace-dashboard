{% extends "base.html" %}
{% block page_title %}{{ month_name }} {{ year }} — по днях{% endblock %}

{% block content %}
{% if error %}
  <div class="alert alert-danger">
    Помилка: {{ error }}
  </div>
{% endif %}
<div class="row g-3">
  <div class="col-lg-7">
    <div class="card card-soft">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-list align-middle mb-0">
            <thead>
              <tr class="text-secondary small">
                <th style="width: 90px">День</th>
                <th>Відправлено</th>
                <th>Перегляди</th>
                <th>Завантаження</th>
              </tr>
            </thead>
            <tbody>
              {% for r in daily %}
              <tr>
                <td>{{ r.day }}</td>
                <td class="fw-semibold">{{ r.submitted }}</td>
                <td class="fw-semibold">{{ r.views }}</td>
                <td class="fw-semibold">{{ r.downloads }}</td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-secondary">Немає даних</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="mt-3">
      <a class="btn btn-outline-secondary" href="{{ url_for('statistics') }}">Назад до помісячної</a>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card card-soft">
      <div class="card-body">
        <div class="text-secondary small mb-2">Динаміка (перегляди/завантаження)</div>
        <canvas id="chart" height="220"></canvas>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const labels = {{ daily|map(attribute='day')|list|tojson }};
  const views = {{ daily|map(attribute='views')|list|tojson }};
  const downloads = {{ daily|map(attribute='downloads')|list|tojson }};

  new Chart(document.getElementById('chart'), {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: 'Перегляди', data: views, tension: 0.25 },
        { label: 'Завантаження', data: downloads, tension: 0.25 },
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom' } },
      scales: { y: { beginAtZero: true } }
    }
  });
</script>
{% endblock %}
